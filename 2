import { dfs, bfs } from "./graph.js"

async function loadGraph() {
const response = await fetch("/data/courses.json");
const graph = await response.json();
console.log("Fetched.");
console.log(graph);
return graph;
}

document.addEventListener("DOMContentLoaded", () => {
  console.log("UI Loaded");
  const input = document.getElementById("input");
  const button = document.getElementById("button");
  const resDiv = document.getElementById("res_div");
  const ul = document.createElement("ul");

  function displayResults({prereqs, coreqs, reverse_prereqs}) {
      for(const c of prereqs) {
        const li = document.createElement("li");
        li.textContent = c;
        ul.appendChild(li);
      }

      for(const c of coreqs) {
        const li = document.createElement("li");
        li.textContent = c;
        ul.appendChild(li);
      }

      resDiv.appendChild(ul);
} 

    
    function validateID(courseID, courseGraph) {
      if(!courseGraph[courseID]) {
        resDiv.innerText = "ERROR: Invalid Course ID.";
        return false;
      }
      return true;
      
    }

    function getEdgesBFS(courseID, courseGraph, edgeKey) {
       return dfs(courseID, courseGraph, edgeKey);
    }

    function getEdgesDFS(courseID, courseGraph, edgeKey) {
       return dfs(courseID, courseGraph, edgeKey);
    }

  loadGraph().then(courseGraph => {
  button.addEventListener("click", () => {
    const courseID = input.value;
    if(validateID(courseID, courseGraph)) {
      const prereqs = getEdgesBFS(courseID, courseGraph, "prereqs");
      if(prereqs.length == 0) {
        prereqs.push("No prerequisites for this course.")
      }
      const coreqs  = getEdgesDFS(courseID, courseGraph, "coreqs");
      console.log(coreqs);
      if(coreqs.length == 0) {
        coreqs.push("No corequisites for this course.")
      }
      const reverse_prereqs = getEdgesDFS(courseID, courseGraph, "reverse_prereqs");
      console.log(reverse_prereqs);
      if(reverse_prereqs.length == 0) {
        reverse_prereqs.push("None"); 
      }
      displayResults({prereqs, coreqs, reverse_prereqs});
    } 
  });
  });
});
